<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CS Quiz Arena - Quiz</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="navbar-placeholder"></div>
  <div class="container">
    <h2 id="quiz-title">Loading Your Quiz...</h2>
    <div id="quiz-box"></div>
    <button id="submit-btn" class="btn" style="display:none;">Submit Quiz</button>
  </div>

  <script>
    const quizBox = document.getElementById("quiz-box");
    const submitBtn = document.getElementById("submit-btn");
    const quizTitle = document.getElementById("quiz-title");
    let questions = [];
    
    const queryParams = new URLSearchParams(window.location.search);
    const subject = queryParams.get("subject") || "cs";
    const examType = queryParams.get("type") || "gate";

    console.log("Subject: " + subject);
    console.log("Exam Type: " + examType);

    // Function to fetch questions from the backend
    async function fetchQuestionsFromChatGPT() {
      quizTitle.innerText = "Generating Questions...";

      try {
        const response = await fetch("http://127.0.0.1:5000/generate-quiz", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ subject, examType })
        });

        const data = await response.json();
        console.log('Received questions:', data);  // Log the received questions
        questions = data;
        renderQuestions();
      } catch (err) {
        quizTitle.innerText = "Error loading quiz.";
        quizBox.innerHTML = `<p style='color:red;'>${err.message}</p>`;
        console.error('Error fetching quiz:', err);  // Log the error
      }
    }

    // Function to render questions on the page
    function renderQuestions() {
      quizTitle.innerText = "Answer the Questions";
      quizBox.innerHTML = "";

      if (questions.length === 0) {
        quizBox.innerHTML = "<p>No questions received from the backend.</p>";
        return;
      }

      questions.forEach((q, idx) => {
        const qDiv = document.createElement("div");
        qDiv.classList.add("question-block");
        qDiv.innerHTML = `
          <p><strong>Q${idx + 1}. ${q.question}</strong></p>
          ${q.options.map((opt, i) => `
            <label>
              <input type="radio" name="q${idx}" value="${opt}" /> ${opt}
            </label><br>
          `).join("")}
        `;
        quizBox.appendChild(qDiv);
      });

      submitBtn.style.display = "block";
    }

    // Submit event for calculating the score
    submitBtn.addEventListener("click", () => {
      let score = 0;

      questions.forEach((q, idx) => {
        const selected = document.querySelector(`input[name='q${idx}']:checked`);
        if (selected && selected.value === q.answer) {
          score++;
        }
      });

      alert(`You scored ${score} out of ${questions.length}`);
    });
    function toggleMenu() {
      const nav = document.getElementById('navbar');
      nav.classList.toggle('active');
    }
    fetch("navbar.html")
      .then(response => response.text())
      .then(data => {
        document.getElementById("navbar-placeholder").innerHTML = data;
      });
    // Fetch the quiz questions
    fetchQuestionsFromChatGPT();
  </script>
</body>
</html>
