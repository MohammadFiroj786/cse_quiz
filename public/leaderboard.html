<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>GATEPrep AI - Leaderboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
    min-height: 100vh;
  }

  .card {
    border-radius: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    background: #ffffffcc;
    backdrop-filter: blur(10px);
  }

  h3 {
    color: #007bff;
  }

  table {
    border-radius: 15px;
    overflow: hidden;
  }

  th {
    background: linear-gradient(135deg,#007bff,#00b4d8);
    color: #fff;
    font-size: 0.95rem;
  }

  td {
    font-size: 0.9rem;
    vertical-align: middle;
  }

  tr:nth-child(1) td {
    font-weight: 700;
    color: #ffd700;
    font-size: 1rem;
  }

  tbody tr:hover {
    background-color: #e0f7ff;
    transition: 0.3s;
  }

  #empty-message {
    text-align: center;
    color: #6c757d;
    font-weight: 500;
    padding: 25px 0;
    font-size: 1rem;
  }

  @media (max-width: 768px) {
    th, td {
      font-size: 0.8rem;
      padding: 0.5rem;
    }
  }

</style>
</head>
<body>

<!-- Navbar placeholder -->
<div id="navbar-placeholder"></div>

<div class="container py-5">
  <div class="card p-4">
    <h3 class="fw-bold text-center mb-4">üèÜ Top Performers (This Month)</h3>
    <div class="table-responsive">
      <table class="table table-striped align-middle text-center shadow-sm">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Name</th>
            <th>Subject</th>
            <th>Score</th>
            <th>%</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="leaderboard-body"></tbody>
      </table>
    </div>
    <p id="empty-message" class="d-none">No results yet. Be the first to appear! üí™</p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Load navbar dynamically
fetch('navbar.html')
  .then(res => res.text())
  .then(html => { document.getElementById('navbar-placeholder').innerHTML = html; })
  .catch(() => console.warn('Navbar load failed'));

// Ensure user is logged in
const storedUser = localStorage.getItem('user');
if (!storedUser) {
  console.warn("‚ö† No user found. Redirecting to login...");
  window.location.href = 'login.html';
}

// Load leaderboard from backend
async function loadLeaderboard() {
  const tbody = document.getElementById('leaderboard-body');
  const emptyMsg = document.getElementById('empty-message');
  tbody.innerHTML = '';
  emptyMsg.classList.add('d-none');

  try {
    const res = await fetch('http://localhost:5000/api/leaderboard'); 
    if (!res.ok) throw new Error(`Server returned ${res.status}`);
    const data = await res.json();

    if (!Array.isArray(data) || data.length === 0) {
      emptyMsg.classList.remove('d-none');
      return;
    }

    data.slice(0, 10).forEach((d, i) => {
      const date = d.createdAt ? new Date(d.createdAt).toLocaleString() : '‚Äî';
      const total = d.totalQuestions || 1;
      const percentage = ((d.score / total) * 100).toFixed(1);

      tbody.innerHTML += `
        <tr>
          <td>${i + 1}</td>
          <td>${d.name || 'Unknown'}</td>
          <td>${d.subject || '‚Äî'}</td>
          <td>${d.score}/${total}</td>
          <td>${percentage}%</td>
          <td>${date}</td>
        </tr>
      `;
    });
  } catch (err) {
    console.error('Error loading leaderboard:', err);
    emptyMsg.textContent = '‚ö†Ô∏è Unable to load leaderboard. Please check your server.';
    emptyMsg.classList.remove('d-none');
  }
}

// Initialize leaderboard
loadLeaderboard();
</script>

</body>
</html>
